<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>nest-typescript-starter documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">nest-typescript-starter documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li>UserService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/user/user.service.ts</code>
        </p>




            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#facebookLogin">facebookLogin</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#forgotPassword">forgotPassword</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#generateJWT">generateJWT</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#getFollowedUsers">getFollowedUsers</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#getListingFollowers">getListingFollowers</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getUser">getUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#getUserFollowedUsers">getUserFollowedUsers</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#getUserFollowers">getUserFollowers</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getUsers">getUsers</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getUsersFollowersCount">getUsersFollowersCount</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#googleLogin">googleLogin</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#localLogin">localLogin</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#register">register</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#resetPassword">resetPassword</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#toggleUserFollow">toggleUserFollow</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#updateUserProfile">updateUserProfile</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(mailManager: <a href="../injectables/MailManager.html">MailManager</a>, fireBase: <a href="../injectables/FireBase.html">FireBase</a>, db: <a href="../injectables/PrismaService.html">PrismaService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="33" class="link-to-prism">src/user/user.service.ts:33</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>mailManager</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/MailManager.html" target="_self" >MailManager</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>fireBase</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/FireBase.html" target="_self" >FireBase</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>db</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/PrismaService.html" target="_self" >PrismaService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="facebookLogin"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Async</span>
                            facebookLogin
                        </b>
                        <a href="#facebookLogin"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>facebookLogin(token: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="180"
                            class="link-to-prism">src/user/user.service.ts:180</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>token</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="forgotPassword"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Async</span>
                            forgotPassword
                        </b>
                        <a href="#forgotPassword"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>forgotPassword(email: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="333"
                            class="link-to-prism">src/user/user.service.ts:333</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>email</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="generateJWT"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Public</span>
                            generateJWT
                        </b>
                        <a href="#generateJWT"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>generateJWT(user)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="364"
                            class="link-to-prism">src/user/user.service.ts:364</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getFollowedUsers"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                            getFollowedUsers
                        </b>
                        <a href="#getFollowedUsers"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getFollowedUsers(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, pageIndex: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, pageSize: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="432"
                            class="link-to-prism">src/user/user.service.ts:432</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>pageIndex</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>1</code>
                                    </td>

                                </tr>
                                <tr>
                                    <td>pageSize</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>10</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;literal type&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getListingFollowers"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                            getListingFollowers
                        </b>
                        <a href="#getListingFollowers"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getListingFollowers(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, listingId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, pageIndex: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, pageSize: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="484"
                            class="link-to-prism">src/user/user.service.ts:484</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>listingId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>pageIndex</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>1</code>
                                    </td>

                                </tr>
                                <tr>
                                    <td>pageSize</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>10</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;literal type&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getUser"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Async</span>
                            getUser
                        </b>
                        <a href="#getUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getUser(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="40"
                            class="link-to-prism">src/user/user.service.ts:40</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../miscellaneous/variables.html#User" target="_self" >Promise&lt;UserDto | null&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getUserFollowedUsers"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                            getUserFollowedUsers
                        </b>
                        <a href="#getUserFollowedUsers"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getUserFollowedUsers(followerId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, userIds: string[])</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="127"
                            class="link-to-prism">src/user/user.service.ts:127</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>followerId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>userIds</td>
                                    <td>
                                            <code>string[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;Array&lt;string&gt;&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getUserFollowers"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                            getUserFollowers
                        </b>
                        <a href="#getUserFollowers"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getUserFollowers(userId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, pageIndex: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, pageSize: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="380"
                            class="link-to-prism">src/user/user.service.ts:380</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>pageIndex</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>1</code>
                                    </td>

                                </tr>
                                <tr>
                                    <td>pageSize</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>10</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;literal type&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getUsers"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Async</span>
                            getUsers
                        </b>
                        <a href="#getUsers"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getUsers(ids: string[])</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="141"
                            class="link-to-prism">src/user/user.service.ts:141</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>ids</td>
                                    <td>
                                            <code>string[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;[] | null&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getUsersFollowersCount"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Async</span>
                            getUsersFollowersCount
                        </b>
                        <a href="#getUsersFollowersCount"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getUsersFollowersCount(userIds: string[])</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="550"
                            class="link-to-prism">src/user/user.service.ts:550</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>userIds</td>
                                    <td>
                                            <code>string[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;literal type[]&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="googleLogin"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Async</span>
                            googleLogin
                        </b>
                        <a href="#googleLogin"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>googleLogin(token)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="228"
                            class="link-to-prism">src/user/user.service.ts:228</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>token</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="localLogin"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Async</span>
                            localLogin
                        </b>
                        <a href="#localLogin"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>localLogin(email: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, password: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="162"
                            class="link-to-prism">src/user/user.service.ts:162</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>email</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>password</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="register"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Async</span>
                            register
                        </b>
                        <a href="#register"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>register(_user: <a href="../classes/RegisterUser.html">RegisterUser</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="282"
                            class="link-to-prism">src/user/user.service.ts:282</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>_user</td>
                                    <td>
                                                <code><a href="../classes/RegisterUser.html" target="_self" >RegisterUser</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;any&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="resetPassword"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Async</span>
                            resetPassword
                        </b>
                        <a href="#resetPassword"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>resetPassword(input: <a href="../interfaces/ResetPassword.html">ResetPassword</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="312"
                            class="link-to-prism">src/user/user.service.ts:312</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>input</td>
                                    <td>
                                                <code><a href="../interfaces/ResetPassword.html" target="_self" >ResetPassword</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>{}</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="toggleUserFollow"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                            toggleUserFollow
                        </b>
                        <a href="#toggleUserFollow"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>toggleUserFollow(toggleModel: <a href="../classes/ToggleUserFollowDto.html">ToggleUserFollowDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="94"
                            class="link-to-prism">src/user/user.service.ts:94</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>toggleModel</td>
                                    <td>
                                                <code><a href="../classes/ToggleUserFollowDto.html" target="_self" >ToggleUserFollowDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;OperationResult&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateUserProfile"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                            updateUserProfile
                        </b>
                        <a href="#updateUserProfile"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateUserProfile(user: <a href="../classes/UserDto.html">UserDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="83"
                            class="link-to-prism">src/user/user.service.ts:83</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>user</td>
                                    <td>
                                                <code><a href="../classes/UserDto.html" target="_self" >UserDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;OperationResult&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &#x27;@nestjs/common&#x27;;
import Axios from &#x27;axios&#x27;;
import { Op } from &#x27;sequelize&#x27;;
import User from &#x27;./../models/User&#x27;;
import { v4 } from &#x27;uuid&#x27;;
import { sendWelcomeNotification } from &#x27;../shared/core/OneSignal&#x27;;
import { google } from &#x27;googleapis&#x27;;
import crypto from &#x27;crypto&#x27;;
import IGoogleProfile from &#x27;./dto/GooglePofile&#x27;;
import RegisterUser from &#x27;./dto/RegisterUser&#x27;;
import ResetPassword from &#x27;./dto/ResetPassword&#x27;;
import PasswordRecoveryToken from &#x27;./../models/PasswordRecoveryToken&#x27;;
import FireBase from &#x27;./../shared/core/FireBase&#x27;;
import MailManager from &#x27;./../shared/core/MailManager&#x27;;
import UserDto from &#x27;./dto/UserDto&#x27;;
import env from &#x27;@/shared/core/Environment&#x27;;
import * as jwt from &#x27;jsonwebtoken&#x27;;
import OperationResult from &#x27;@/shared/models/OperationResult&#x27;;
import UserFollower from &#x27;./../models/UserFollower&#x27;;
import ToggleUserFollowDto from &#x27;./dto/ToggleUserFollowDto&#x27;;
import sequelize from &#x27;sequelize&#x27;;
import Listing from &#x27;./../models/Listing&#x27;;
import Story from &#x27;./../models/Story&#x27;;
import { UserSnippetDto } from &#x27;./dto/UserSnippetDto&#x27;;
import ListingFollower from &#x27;./../models/ListingFollower&#x27;;
import { PrismaService } from &#x27;@/shared/core/prisma.service&#x27;;
const JWT_SECRET &#x3D; env.JWT_SECRET;

const OAuth2 &#x3D; google.auth.OAuth2;
const oauth2Client &#x3D; new OAuth2();

@Injectable()
export class UserService {
  constructor(
    private readonly mailManager: MailManager,
    private readonly fireBase: FireBase,
    private readonly db: PrismaService,
  ) {}

  async getUser(id: string): Promise&lt;UserDto | null&gt; {
    const user &#x3D; await User.findOne({
      where: {
        id: id,
      },
    });

    const prUser &#x3D; await this.db.user.findFirst({
      where: { id: id },
    });
    console.log(prUser);

    if (user) {
      const followersCounts &#x3D; await this.getUsersFollowersCount([user.id]);
      const listings &#x3D; await Listing.findAndCountAll({
        where: {
          ownerId: user.id,
        },
      });
      const stories &#x3D; await Story.findAndCountAll({
        where: {
          ownerId: user.id,
        },
      });

      return {
        type: &#x27;user&#x27;,
        id: user.id,
        name: user.name,
        photoUrl: user.photoUrl,
        featuredProductName: user.featuredProductName,
        featuredProductId: user.featuredProductId,
        followersCount:
          followersCounts &amp;&amp; followersCounts.length &gt; 0
            ? followersCounts[0].followersCount
            : 0,
        productsCount: listings ? listings.count : 0,
        storiesCount: stories ? stories.count : 0,
      };
    }
    return null;
  }

  public async updateUserProfile(user: UserDto): Promise&lt;OperationResult&gt; {
    await User.update(user, {
      where: {
        id: user.id,
      },
    });
    const result &#x3D; new OperationResult();
    result.success &#x3D; true;
    return result;
  }

  public async toggleUserFollow(
    toggleModel: ToggleUserFollowDto,
  ): Promise&lt;OperationResult&gt; {
    const result &#x3D; new OperationResult();
    try {
      const existingFollower &#x3D; await UserFollower.findOne({
        where: {
          userId: toggleModel.userId,
          followerId: toggleModel.followerId,
        },
      });

      if (!existingFollower &amp;&amp; toggleModel.isFollowed &#x3D;&#x3D;&#x3D; true) {
        await UserFollower.create({
          id: v4(),
          userId: toggleModel.userId,
          followerId: toggleModel.followerId,
        });
      } else if (existingFollower &amp;&amp; toggleModel.isFollowed &#x3D;&#x3D;&#x3D; false) {
        await UserFollower.destroy({
          where: {
            id: existingFollower.id,
          },
        });
      }
      result.success &#x3D; true;
    } catch (error) {
      result.success &#x3D; false;
      result.message &#x3D; error;
    }
    return result;
  }

  public async getUserFollowedUsers(
    followerId: string,
    userIds: string[],
  ): Promise&lt;Array&lt;string&gt;&gt; {
    const followings &#x3D; await UserFollower.findAll({
      where: {
        followerId: followerId,
        userId: userIds,
      },
    });
    if (followings) return followings.map((f) &#x3D;&gt; f.userId);
    return [];
  }

  async getUsers(ids: string[]): Promise&lt;UserDto[] | null&gt; {
    const users &#x3D; await User.findAll({
      where: {
        id: ids,
      },
    });
    if (users)
      return users.map((user) &#x3D;&gt; ({
        type: &#x27;user&#x27;,
        id: user.id,
        name: user.name,
        photoUrl: user.photoUrl,
        featuredProductName: user.featuredProductName,
        featuredProductId: user.featuredProductId,
        followersCount: 0,
        productsCount: 0,
        storiesCount: 0,
      }));
    return null;
  }

  async localLogin(email: string, password: string): Promise&lt;any&gt; {
    const user &#x3D; await User.findOne({
      where: {
        email: email,
      },
    });
    if (!user) {
      return { status: &#x27;ERROR&#x27;, error: { message: &#x27;Invalid user name&#x27; } };
    }
    const hash &#x3D; crypto.createHash(&#x27;sha256&#x27;).update(password).digest(&#x27;base64&#x27;);

    if (user.hash &#x3D;&#x3D;&#x3D; hash) {
      return { status: &#x27;SUCCESS&#x27;, data: user };
    }

    return { status: &#x27;ERROR&#x27;, error: { message: &#x27;Invalid Password&#x27; } };
  }

  async facebookLogin(token: string): Promise&lt;any&gt; {
    try {
      const fbRes &#x3D; await Axios.get(&#x27;https://graph.facebook.com/v2.9/me&#x27;, {
        params: { access_token: token, fields: &#x27;id,name,email&#x27; },
      });
      const facebookProfile &#x3D; fbRes.data;

      let user &#x3D; await User.findOne({
        where: {
          [Op.or]: [
            { facebookId: facebookProfile.id },
            { email: facebookProfile.email },
          ],
        },
      });

      if (
        !facebookProfile.name ||
        !facebookProfile.email ||
        !facebookProfile.id
      ) {
        return { status: &#x27;NO_DATA&#x27; };
      }

      if (!user) {
        user &#x3D; await User.create({
          id: v4(),
          name: facebookProfile.name,
          email: facebookProfile.email,
          facebookId: facebookProfile.id,
          hash: &#x27;&#x27;,
          notificationsEnabled: false,
        });
      } else if (user.facebookId !&#x3D;&#x3D; facebookProfile.id) {
        await User.update(
          { facebookId: facebookProfile.id },
          { where: { email: facebookProfile.email } },
        );
      }

      await sendWelcomeNotification(facebookProfile.email);

      return { status: &#x27;SUCCESS&#x27;, data: user };
    } catch (err) {
      return { status: &#x27;ERROR&#x27;, error: err };
    }
  }

  async googleLogin(token): Promise&lt;any&gt; {
    try {
      oauth2Client.setCredentials({ access_token: token });
      const oauth2 &#x3D; google.oauth2({ auth: oauth2Client, version: &#x27;v2&#x27; });

      const googleProfile: IGoogleProfile &#x3D; await new Promise(
        (resolve, reject) &#x3D;&gt; {
          return oauth2.userinfo.get((err, res) &#x3D;&gt; {
            if (err || !res) {
              reject(err);
            } else {
              resolve(res.data);
            }
          });
        },
      );

      let user &#x3D; await User.findOne({
        where: {
          [Op.or]: [
            { googleId: googleProfile.id },
            { email: googleProfile.email },
          ],
        },
      });

      if (!googleProfile.name || !googleProfile.email || !googleProfile.id) {
        return { status: &#x27;NO_DATA&#x27; };
      }

      if (!user) {
        user &#x3D; await User.create({
          id: v4(),
          name: googleProfile.name,
          email: googleProfile.email,
          googleId: googleProfile.id,
          hash: &#x27;&#x27;,
          notificationsEnabled: false,
        });
      } else if (user.googleId !&#x3D;&#x3D; googleProfile.id) {
        await User.update(
          { googleId: googleProfile.id },
          { where: { email: googleProfile.email } },
        );
      }

      await sendWelcomeNotification(googleProfile.email);

      return { status: &#x27;SUCCESS&#x27;, data: user };
    } catch (err) {
      return { status: &#x27;ERROR&#x27;, error: err };
    }
  }

  async register(_user: RegisterUser): Promise&lt;any&gt; {
    try {
      const existingUser &#x3D; await User.findOne({
        where: { email: _user.email },
      });
      if (existingUser) {
        return {
          status: &#x27;ERROR&#x27;,
          error: { message: &#x27;A user with this email address already exists!&#x27; },
        };
      }

      const hash &#x3D; crypto
        .createHash(&#x27;sha256&#x27;)
        .update(_user.password)
        .digest(&#x27;base64&#x27;);
      _user.hash &#x3D; hash;
      _user.id &#x3D; v4();
      const user &#x3D; await User.create(_user);

      if (_user.notificationsEnabled) {
        await sendWelcomeNotification(_user.email);
      }

      return { status: &#x27;SUCCESS&#x27;, data: user };
    } catch (err) {
      return { status: &#x27;ERROR&#x27;, error: err };
    }
  }

  async resetPassword(input: ResetPassword) {
    const user &#x3D; await User.findOne({ where: { email: input.email } });
    if (!user) {
      return { status: &#x27;NOT_FOUND&#x27; };
    }

    const recoveryToken &#x3D; await PasswordRecoveryToken.findOne({
      where: { userId: user.id, token: input.token },
    });
    if (!recoveryToken) {
      return { status: &#x27;NOT_FOUND&#x27; };
    }

    const hash &#x3D; crypto
      .createHash(&#x27;sha256&#x27;)
      .update(input.newPassword)
      .digest(&#x27;base64&#x27;);
    await User.update({ hash }, { where: { email: input.email } });
    return { status: &#x27;SUCCESS&#x27; };
  }

  async forgotPassword(email: string): Promise&lt;any&gt; {
    try {
      const user &#x3D; await User.findOne({ where: { email } });
      if (!user) {
        return { status: &#x27;NOT_FOUND&#x27; };
      }

      const recoveryToken &#x3D; crypto.randomBytes(128).toString(&#x27;hex&#x27;);
      await PasswordRecoveryToken.create({
        id: v4(),
        token: recoveryToken,
        userId: user.id,
      });

      const firebaseDynamicLink &#x3D; await this.fireBase.getFirebaseDynamicLink(
        recoveryToken,
        email,
      );

      await this.mailManager.sendRecoveryLink(
        email,
        user.name,
        firebaseDynamicLink.data.shortLink,
      );

      return { status: &#x27;SUCCESS&#x27; };
    } catch (err) {
      return { status: &#x27;ERROR&#x27;, error: err };
    }
  }

  public generateJWT(user) {
    const today &#x3D; new Date();
    const exp &#x3D; new Date(today);
    exp.setDate(today.getDate() + 60);

    return jwt.sign(
      {
        id: user.id,
        name: user.name,
        email: user.email,
        exp: exp.getTime() / 1000,
      },
      JWT_SECRET,
    );
  }

  public async getUserFollowers(
    userId: string,
    pageIndex &#x3D; 1,
    pageSize &#x3D; 10,
  ): Promise&lt;{ count: number; data: UserSnippetDto[] }&gt; {
    const followers &#x3D; await UserFollower.findAndCountAll({
      where: {
        userId: userId,
      },
      limit: pageSize,
      offset: (pageIndex - 1) * pageSize,
    });

    const followerIds &#x3D;
      followers &amp;&amp; followers.count &gt; 0
        ? followers.rows.map((f) &#x3D;&gt; f.followerId)
        : [];
    if (followerIds.length &gt; 0) {
      const followeds &#x3D; await UserFollower.findAll({
        where: {
          userId: followerIds,
          followerId: userId,
        },
      });
      const users &#x3D; await this.getUsers(followerIds);
      const result: UserSnippetDto[] &#x3D; users.map((u) &#x3D;&gt; {
        return {
          type: &#x27;user&#x27;,
          id: u.id,
          name: u.name,
          photoUrl: u.photoUrl,
          featuredProductId: u.featuredProductId,
          featuredProductName: u.featuredProductName,
          isFriend: false,
          isFollower: true,
          isFollowed:
            followeds &amp;&amp; followeds.find((f) &#x3D;&gt; f.userId &#x3D;&#x3D;&#x3D; u.id)
              ? true
              : false,
        };
      });
      return {
        count: followers.count,
        data: result,
      };
    }
    return {
      count: 0,
      data: [],
    };
  }

  public async getFollowedUsers(
    userId: string,
    pageIndex &#x3D; 1,
    pageSize &#x3D; 10,
  ): Promise&lt;{ count: number; data: UserSnippetDto[] }&gt; {
    const followeds &#x3D; await UserFollower.findAndCountAll({
      where: {
        followerId: userId,
      },
      limit: pageSize,
      offset: (pageIndex - 1) * pageSize,
    });

    const followedIds &#x3D;
      followeds &amp;&amp; followeds.count &gt; 0
        ? followeds.rows.map((f) &#x3D;&gt; f.userId)
        : [];
    if (followedIds.length &gt; 0) {
      const followers &#x3D; await UserFollower.findAll({
        where: {
          followerId: followedIds,
          userId: userId,
        },
      });
      const users &#x3D; await this.getUsers(followedIds);
      const result: UserSnippetDto[] &#x3D; users.map((u) &#x3D;&gt; {
        return {
          type: &#x27;user&#x27;,
          id: u.id,
          name: u.name,
          photoUrl: u.photoUrl,
          featuredProductId: u.featuredProductId,
          featuredProductName: u.featuredProductName,
          isFriend: false,
          isFollower:
            followers &amp;&amp; followers.find((f) &#x3D;&gt; f.followerId &#x3D;&#x3D;&#x3D; u.id)
              ? true
              : false,
          isFollowed: true,
        };
      });
      return {
        count: followeds.count,
        data: result,
      };
    }
    return {
      count: 0,
      data: [],
    };
  }

  public async getListingFollowers(
    userId: string,
    listingId: string,
    pageIndex &#x3D; 1,
    pageSize &#x3D; 10,
  ): Promise&lt;{ count: number; data: UserSnippetDto[] }&gt; {
    const followers &#x3D; await ListingFollower.findAndCountAll({
      where: {
        listingId: listingId,
      },
      limit: pageSize,
      offset: (pageIndex - 1) * pageSize,
    });
    const followerIds &#x3D;
      followers &amp;&amp; followers.count &gt; 0
        ? followers.rows.map((f) &#x3D;&gt; f.userId)
        : [];
    if (followerIds.length &gt; 0) {
      const followeds &#x3D; userId
        ? await UserFollower.findAll({
            where: {
              userId: followerIds,
              followerId: userId,
            },
          })
        : null;

      const followings &#x3D; userId
        ? await UserFollower.findAll({
            where: {
              userId: userId,
              followerId: followerIds,
            },
          })
        : null;
      const users &#x3D; await this.getUsers(followerIds);
      const result: UserSnippetDto[] &#x3D; users.map((u) &#x3D;&gt; {
        return {
          type: &#x27;user&#x27;,
          id: u.id,
          name: u.name,
          photoUrl: u.photoUrl,
          featuredProductId: u.featuredProductId,
          featuredProductName: u.featuredProductName,
          isFriend: false,
          isFollower:
            followings &amp;&amp; followings.find((f) &#x3D;&gt; f.followerId &#x3D;&#x3D;&#x3D; u.id)
              ? true
              : false,
          isFollowed:
            followeds &amp;&amp; followeds.find((f) &#x3D;&gt; f.userId &#x3D;&#x3D;&#x3D; u.id)
              ? true
              : false,
        };
      });
      return {
        count: followers.count,
        data: result,
      };
    }
    return {
      count: 0,
      data: [],
    };
  }

  async getUsersFollowersCount(
    userIds: string[],
  ): Promise&lt;{ userId: string; followersCount: number }[]&gt; {
    const result &#x3D; await UserFollower.findAll({
      attributes: [
        &#x27;userId&#x27;,
        [sequelize.fn(&#x27;COUNT&#x27;, &#x27;followerId&#x27;), &#x27;followerId&#x27;],
      ],
      group: [&#x27;userId&#x27;],
      where: {
        userId: userIds,
      },
    });
    return result.map((r: any) &#x3D;&gt; ({
      userId: r.userId,
      followersCount: Number(r.followerId),
    }));
  }
}
</code></pre>
    </div>

</div>







                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'UserService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
