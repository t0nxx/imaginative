<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>nest-typescript-starter documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">nest-typescript-starter documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li>StoryService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/story/story.service.ts</code>
        </p>




            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#addStory">addStory</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#deleteStory">deleteStory</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#getAllStories">getAllStories</a>
                            </li>
                            <li>
                                <a href="#getListingSnippet">getListingSnippet</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#getStory">getStory</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#mapStory">mapStory</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#searchStories">searchStories</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#updateStory">updateStory</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(lookupsService: <a href="../injectables/LookupsService.html">LookupsService</a>, userService: <a href="../injectables/UserService.html">UserService</a>, listingService: <a href="../injectables/ListingService.html">ListingService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="15" class="link-to-prism">src/story/story.service.ts:15</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>lookupsService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/LookupsService.html" target="_self" >LookupsService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/UserService.html" target="_self" >UserService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>listingService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/ListingService.html" target="_self" >ListingService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="addStory"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                            addStory
                        </b>
                        <a href="#addStory"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>addStory(lang: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, storyData: <a href="../interfaces/CreateStoryDto.html">CreateStoryDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="22"
                            class="link-to-prism">src/story/story.service.ts:22</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>lang</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>storyData</td>
                                    <td>
                                                <code><a href="../interfaces/CreateStoryDto.html" target="_self" >CreateStoryDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/StoryDto.html" target="_self" >Promise&lt;StoryDto&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="deleteStory"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                            deleteStory
                        </b>
                        <a href="#deleteStory"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>deleteStory(ownerId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="91"
                            class="link-to-prism">src/story/story.service.ts:91</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>ownerId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;OperationResult&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getAllStories"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                            getAllStories
                        </b>
                        <a href="#getAllStories"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getAllStories(lang: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="48"
                            class="link-to-prism">src/story/story.service.ts:48</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>lang</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/StoryDto.html" target="_self" >Promise&lt;StoryDto[]&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getListingSnippet"></a>
                    <span class="name">
                        <b>
                            getListingSnippet
                        </b>
                        <a href="#getListingSnippet"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getListingSnippet(listing?: <a href="../interfaces/ListingDto.html">ListingDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="223"
                            class="link-to-prism">src/story/story.service.ts:223</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>listing</td>
                                    <td>
                                                <code><a href="../interfaces/ListingDto.html" target="_self" >ListingDto</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getStory"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                            getStory
                        </b>
                        <a href="#getStory"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getStory(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, lang: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, userId?: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="59"
                            class="link-to-prism">src/story/story.service.ts:59</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>lang</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/StoryDto.html" target="_self" >Promise&lt;StoryDto | null&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="mapStory"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Async</span>
                            mapStory
                        </b>
                        <a href="#mapStory"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>mapStory(story: <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank">any</a>, lang: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, userFollowings: string[])</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="191"
                            class="link-to-prism">src/story/story.service.ts:191</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>story</td>
                                    <td>
                                                <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>lang</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>userFollowings</td>
                                    <td>
                                            <code>string[]</code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>[]</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/StoryDto.html" target="_self" >Promise&lt;StoryDto&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="searchStories"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                            searchStories
                        </b>
                        <a href="#searchStories"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>searchStories(searchModel: <a href="../interfaces/StoryDto.html">SearchStoryDto</a>, lang: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, userId?: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="134"
                            class="link-to-prism">src/story/story.service.ts:134</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>searchModel</td>
                                    <td>
                                                <code><a href="../interfaces/StoryDto.html" target="_self" >SearchStoryDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>lang</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>userId</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/StoryDto.html" target="_self" >Promise&lt;SearchResultDto&lt;StoryDto&gt;&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateStory"></a>
                    <span class="name">
                        <b>
                            <span class="modifier">Public</span>
                            <span class="modifier">Async</span>
                            updateStory
                        </b>
                        <a href="#updateStory"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>updateStory(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, lang: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, storyData: <a href="../interfaces/CreateStoryDto.html">CreateStoryDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="30"
                            class="link-to-prism">src/story/story.service.ts:30</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>lang</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>storyData</td>
                                    <td>
                                                <code><a href="../interfaces/CreateStoryDto.html" target="_self" >CreateStoryDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/StoryDto.html" target="_self" >Promise&lt;StoryDto&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &#x27;@nestjs/common&#x27;;
import Story from &#x27;../models/Story&#x27;;
import CreateStoryDto from &#x27;./dto/CreateStoryDto&#x27;;
import StoryDto from &#x27;./dto/StoryDto&#x27;;
import { LookupsService } from &#x27;../lookups/lookups.service&#x27;;
import { UserService } from &#x27;@/user/user.service&#x27;;
import OperationResult from &#x27;../shared/models/OperationResult&#x27;;
import { ErrorCodes } from &#x27;@/shared/constants&#x27;;
import SearchResultDto from &#x27;@/shared/models/SearchResultDto&#x27;;
import SearchStoryDto from &#x27;./dto/SearchStoryDto&#x27;;
import { ListingService } from &#x27;@/listing/listing.service&#x27;;
import ListingDto from &#x27;@/listing/dto/ListingDto&#x27;;

@Injectable()
export class StoryService {
  constructor(
    private lookupsService: LookupsService,
    private userService: UserService,
    private listingService: ListingService,
  ) {}

  public async addStory(
    lang: string,
    storyData: CreateStoryDto,
  ): Promise&lt;StoryDto&gt; {
    const story &#x3D; await Story.create(storyData);
    return this.mapStory(story, lang);
  }

  public async updateStory(
    id: string,
    lang: string,
    storyData: CreateStoryDto,
  ): Promise&lt;StoryDto&gt; {
    await Story.update(storyData, {
      where: {
        id: id,
      },
    });
    const story &#x3D; await Story.findOne({
      where: {
        id: id,
      },
    });
    return this.mapStory(story, lang);
  }

  public async getAllStories(lang: string): Promise&lt;StoryDto[]&gt; {
    const stories &#x3D; await Story.findAll({
      order: [[&#x27;createdAt&#x27;, &#x27;DESC&#x27;]],
    });
    const storyDtos: StoryDto[] &#x3D; [];
    for (const story of stories) {
      storyDtos.push(await this.mapStory(story, lang));
    }
    return storyDtos;
  }

  public async getStory(
    id: string,
    lang: string,
    userId?: string,
  ): Promise&lt;StoryDto | null&gt; {
    const dbStory &#x3D; await Story.findOne({
      where: {
        id: id,
      },
    });
    if (dbStory) {
      let userFollowings: string[] &#x3D; [];
      if (dbStory &amp;&amp; userId) {
        userFollowings &#x3D; await this.userService.getUserFollowedUsers(userId, [
          dbStory.ownerId,
        ]);
      }
      const story &#x3D; await this.mapStory(dbStory, lang, userFollowings);
      if (dbStory?.listingId) {
        const listing &#x3D; await this.listingService.getListing(
          dbStory.listingId,
          lang,
        );
        if (listing) {
          story.listing &#x3D; this.getListingSnippet(listing);
        }
      }
      return story;
    }
    return null;
  }

  public async deleteStory(
    ownerId: string,
    id: string,
  ): Promise&lt;OperationResult&gt; {
    const result &#x3D; new OperationResult();
    try {
      const story &#x3D; await Story.findOne({
        where: {
          id: id,
          ownerId: ownerId,
        },
      });
      if (!story) {
        result.success &#x3D; false;
        result.code &#x3D; ErrorCodes.NOT_FOUND;
      } else {
        const mediaFiles &#x3D; story.media;
        if (mediaFiles) {
          for (const media of mediaFiles) {
            if (media.bucket &amp;&amp; media.type &amp;&amp; media.fileName)
              this.lookupsService.deleteFile(
                media.bucket,
                media.type,
                media.fileName,
              );
          }
        }
        await Story.destroy({
          where: {
            id: id,
            ownerId: ownerId,
          },
        });
        result.success &#x3D; true;
      }
    } catch (error) {
      result.success &#x3D; false;
      result.code &#x3D; ErrorCodes.GENERAL_ERROR;
      result.message &#x3D; error;
    }
    return result;
  }

  public async searchStories(
    searchModel: SearchStoryDto,
    lang: string,
    userId?: string,
  ): Promise&lt;SearchResultDto&lt;StoryDto&gt;&gt; {
    const where: any &#x3D; {};
    if (searchModel.ownerId &amp;&amp; searchModel.ownerId !&#x3D;&#x3D; &#x27;&#x27;) {
      where.ownerId &#x3D; searchModel.ownerId;
    }
    if (searchModel.listingId &amp;&amp; searchModel.listingId !&#x3D;&#x3D; &#x27;&#x27;) {
      where.listingId &#x3D; searchModel.listingId;
    }
    if (searchModel.status !&#x3D; undefined) {
      where.status &#x3D; searchModel.status;
    }

    const stories &#x3D; await Story.findAndCountAll({
      where: where,
      offset: ((searchModel.pageIndex || 1) - 1) * (searchModel.pageSize || 10),
      limit: searchModel.pageSize,
      order: [[&#x27;createdAt&#x27;, &#x27;DESC&#x27;]],
    });

    const result &#x3D; new SearchResultDto&lt;StoryDto&gt;();
    result.count &#x3D; stories.count;
    if (result.count &gt; 0) {
      const storiesWithListings &#x3D; stories.rows.filter(
        (story) &#x3D;&gt; story.listingId !&#x3D; undefined,
      );
      let listings: ListingDto[] &#x3D; [];
      if (storiesWithListings &amp;&amp; storiesWithListings.length &gt; 0) {
        const listingIds &#x3D; storiesWithListings.map(
          (story) &#x3D;&gt; story.listingId || &#x27;&#x27;,
        );
        listings &#x3D; await this.listingService.getListingsByIds(lang, listingIds);
      }
      const ownerIds &#x3D; stories.rows.map((s) &#x3D;&gt; s.ownerId);

      let userFollowings: string[] &#x3D; [];
      if (userId)
        userFollowings &#x3D; await this.userService.getUserFollowedUsers(
          userId,
          ownerIds,
        );
      for (const dbStory of stories.rows) {
        const story &#x3D; await this.mapStory(dbStory, lang, userFollowings);
        if (dbStory.listingId !&#x3D; undefined) {
          story.listing &#x3D; this.getListingSnippet(
            listings.find((l) &#x3D;&gt; l.id &#x3D;&#x3D;&#x3D; dbStory.listingId),
          );
        }
        result.data.push(story);
      }
    }
    return result;
  }

  async mapStory(
    story: any,
    lang: string,
    userFollowings: string[] &#x3D; [],
  ): Promise&lt;StoryDto&gt; {
    const disclaimers &#x3D; await this.lookupsService.getDisclaimers(lang);
    const user &#x3D; await this.userService.getUser(story.ownerId);
    return {
      id: story.id,
      type: &#x27;Story&#x27;,
      owner: user,
      listingId: story.listingId,
      disclaimerId: story.disclaimerId,
      disclaimerName:
        disclaimers.find((lt) &#x3D;&gt; lt.id &#x3D;&#x3D;&#x3D; story.disclaimerId)?.name || &#x27;&#x27;,
      privacy: story.privacy,
      media: story.media,
      headerLine: story.headerLine,
      body: story.body,
      intro: story.intro,
      tagline: story.tagline,
      conclusion: story.conclusion,
      imaginativeYear: story.imaginativeYear,
      status: story.status,
      isUserFollowed: userFollowings.find((f) &#x3D;&gt; f &#x3D;&#x3D;&#x3D; story.ownerId)
        ? true
        : false,
      createdAt: story.createdAt,
      updatedAt: story.updatedAt,
    };
  }

  getListingSnippet(listing?: ListingDto): any {
    if (listing) {
      return {
        id: listing.id,
        brandName: listing.brandName,
        name: listing.name,
        ratings: 0,
        media: listing.media,
        followers: 0,
        stories: 1,
        priceType: listing.priceTypeName,
        hiringType: listing.otherHiring || listing.hiringTypeName,
        otherPriceType: listing.otherPriceType,
        priceTypeFormat: listing.priceTypeFormat,
        stockAvailability: listing.stockAvailability,
        price: listing.price,
        currencySymbol: listing.currencySymbol,
        currencyCode: listing.currencyStandardCode,
        offerPrice: listing.offerPrice,
        avgReviews: Number(listing.avgReviews ?? 0),
        reviewsCount: Number(listing.reviewsCount ?? 0),
      };
    }
    return null;
  }
}
</code></pre>
    </div>

</div>







                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'StoryService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
